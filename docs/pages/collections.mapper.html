<!-- Follow.js: collection's mapper -->

<h3>follow.mapper.js</h3>
<p>
	Маппер предоставляет API для быстрой выборки и обновления данных из коллекции в модели.
</p>

<h3 class="pre"><span class="array">stack</span> model.select(
	<span class="string">chain</span>,
	<span class="string">condition</span>,
	<span class="string">[returnValue]</span>
)</h3>

<p>
	В качестве первого аргумента (<em>chain</em>) необходимо передавать цепочку к свойству-массиву, также как и в <a href="#Follow.API">Getter-API</a>.<br />
	Вторым аргументом (<em>condition</em>) можно формировать логическое выражение составляющее условие для выборки элементов 
	(актуально в случае, если элемент коллекции объект или массив).<br />
	Третий аргумент (<em>returnValue</em>) позволяет возвратить отдельно взятые свойства из найденных элементов-объектов коллекции.
</p>
<p>
	Возвращаемое значение для <em>model.select</em> &mdash; массив (<em>stack</em>) с найденными элементами коллекции
	(или их частью в случае использования <em>returnValue</em>), расширенный дополнительными методами:
</p>

<h3 class="pre"><span class="function">model</span> stack.update(
	<span class="mixed">(mixed)</span> value,
	<span class="boolean">every</span>
)</h3>

<h3 class="pre"><span class="function">model</span> stack.remove(
	<span class="boolean">every</span>
)</h3>

<p>
	Метод <em>stack.update</em> обновляет значения для выбранных данных из коллекции. <br />
	Если передать вторым аргументом (<em>every</em>) значение <em>true</em>, 
	то будут вызваны (<a href="#">model.dispatch</a>) отдельно взятые цепочки затрагиваемых данных в элементах коллекции,
	вместо одного вызова для всей коллекции (т.е первого аргумента "<em>chain</em>").
</p>
<p>
	Метод <em>stack.remove</em> является простым алиасом для <em>stack.update</em>, который 
	в качестве первого аргумента (<em>value</em>) передает значение <em>undefined</em>.
</p>

<code id="model">
	var
		model = Follow('sample', {}),
		search = [];
	
	// рассмотрим следующую коллекцию для примеров ниже
	model('collection', [
		{x: 1, y: 1, color: 'blue', b: true},
		{x: 0, y: 2, color: 'red', b: "true", test: [1,0,2]},
		{x: 1, y: 3, color: 'red'},
		{x: 0, y: 4, values: [0,1]},
		{z: 1, y: 5, children: {count: 3, list: ['one', 'two', 'three']}, x: null }
	]);
	
	// будем отслеживать любые изменения в модели
	model.follow(/.*/, function( value, params ){
		alert([
			params.chain +" = "+ JSON.stringify(value),
			"Model: "+ this
		].join('\n\n'));
	});
</code>

<h3>Примеры выборки данных из коллекции</h3>
<code dependent-on="model">
	// список элементов с красным цветом
	search.push(
		model.select('collection', 'color[="red"]')
	);

	// список элементов, у которых свойство "x" равно "y" или существует свойство "z"
	search.push(
		model.select('collection', 'x[=y] || z')
	);

	// получим все цвета элементов с "x" равным единице
	search.push(
		model.select('collection', 'x[=1]', 'color')
	);

	// выбираем элементы, у которых "y" больше или равно 3 и есть свойство "children"
	// из найденных элементов кладем в стэк само значение "y"
	// поэтому, если применить stack.update, то изменится лишь значение "y"
	search.push(
		model.select('collection', 'y[>=3] && children', 'y')
	);
	
	alert( search.join('\n') );
</code>

<h3>Примеры обновления данных в коллекции</h3>
<code dependent-on="model">
	// отличие в вызове колбэков при every=true
	model
		.backup()
		.select('collection', 'x[=0]')
		.update('Changed!');
	model
		.restore()
		.select('collection', 'x[=0]')
		.update('Changed with with using second argument', true);
</code>

<code dependent-on="model">
	// обновим значение цвета для элементов, у которых есть свойство "color"
	model
		.select('collection', null, 'color')
		.update('green');
</code>

<code dependent-on="model">
	// добавим свойство "values" ко всем элементам, если оно не существует
	model.select('collection').update(function( elem )
	{
		if( elem.values === undefined ){
			elem.values = [];
		}
		return elem;
	});
</code>

<h3>Примеры удаления данных из колекции</h3>
<code dependent-on="model">
	// удалим все элементы, не имеющие свойства "children"
	model
		.select('collection', "!children")
		.remove();
</code>

<code dependent-on="model">
	// у элементов, с голубым цветом или имеющих свойство "children" удалим свойство "y"
	model
		.select('collection', "color[='blue'] || children", "y")
		.remove();
</code>

<a href="#" class="next">collections.helper</a>












