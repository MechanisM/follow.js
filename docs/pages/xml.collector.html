<!-- XML-маппинг и модульность -->

<h3>Сборка данных и модульность</h3>

<p>
	Для проектов, работающих с использованием <em>XML/XSL</em>, библиотека имеет 
    официальное дополнение в виде 2 файлов <em>follow.collector.xsl</em> и <em>follow.collector.js</em>.
</p>
<ol class="space">
    <li>В XML-файлах проекта размещаем специальным образом составленные мапперы для агрегации данных</li>
    <li>В XSL-файле перед <em>&lt;/body&gt;</em> вызываем специальный шаблон из <em>follow.collector.xsl</em> для обработки XML-мапперов из всего проекта</li>
</ol>

<h3>Зависимости</h3>
<ol>
    <li>XSLT-процессор должен поддерживать модули <a href="http://exslt.org/" target="_blank">EXSLT</a>, как минимум <em>common, functions и dynamic</em></li>
    <li>
    	Для загрузки внешних модулей и зависимостей используется 
        <a href="http://jquery.com/" target="_blank">jQuery</a> или 
        <a href="http://yepnopejs.com/" target="_blank">YepNope.js</a>
    </li>
</ol>

<h3>XMLNS</h3>
<p>
	<em>xmlns:js="https://github.com/extensible/follow.js"</em>
</p>

<h3>&lt;js:model&gt;</h3>
<div class="space-left">
    <strong>Аттрибуты</strong>
    <ul>
        <li>@name - название модели (первый аргумент конструктора <a href="#Follow">Follow</a>)</li>
        <li>@storage - JS-объект для хранения модели (например <em>window.localStorage</em>)</li>
        <li>@context - XPath-выражение для формирования массива данных, также задает контекст</li>
        <li>@module - Если указано значение "true", то будет произведена попытка загрузки модуля с названием модели (по-умолчанию "default")</li>
        <li>
        	@dependency - список имен файлов через пробел (без расширения ".js"), которые необходимо загрузить прежде, 
            чем данные из маппера <em>js:model</em> попадут в JS-модель. <br />
            Файлы будут загружены перед загрузкой модуля, если аргумент @module = "true"
        </li>
    </ul>
    <strong>Потомки</strong> &mdash; <em>&lt;js:map&gt;</em> или <em>&lt;js:obj&gt;</em> с аттрибутом <em>@chain</em>
</div>

<h3>&lt;js:map&gt;, &lt;js:obj&gt;</h3>
<div class="space-left">
    <strong>Аттрибуты</strong>
    <ul>
        <li>@chain - задает "цепочку" в модели, <strong>только для прямых потомков &lt;js:model&gt;</strong></li>
        <li>@context - XPath-выражение для формирования массива данных, также задает контекст</li>
    </ul>
    <strong>Потомки для js:map</strong> &mdash; <em>&lt;js:map&gt;</em>, <em>&lt;js:obj&gt;</em>, <em>&lt;js:prop&gt;</em><br />
    <strong>Потомки для js:obj</strong> &mdash; <em>&lt;js:prop&gt;</em> с аттрибутом <em>@name</em>
</div>

<h3>&lt;js:prop&gt;</h3>
<div class="space-left">
    <strong>Аттрибуты</strong>
    <ul>
        <li>@name - задает название свойства для родительского элемента &lt;js:obj&gt;, необязателен для &lt;js:map&gt;</li>
        <li>@value - XPath-выражение для значения свойства, не следует его указывать, если свойство имеет потомков</li>
        <li>@type - приведение типа данных к <em>number</em> или <em>boolean</em>, по-умолчанию <em>string</em></li>
    </ul>
    <strong>Потомки</strong> &mdash; <em>&lt;js:map&gt;</em> или <em>&lt;js:obj&gt;</em>
</div>

<h3>XSL</h3>
<ol>
    <li>Подключите файл <em>follow.collector.xsl</em> через <em>&lt;xsl:import&gt;</em> в общий XSL-файл проекта</li>
    <li>Подключите файл <em>follow.collector.js</em> в &lt;head&gt; в HTML</li>
    <li>
    	В нужном месте в шаблоне проекта (рекомендуется в конце <em>&lt;body&gt;</em>) необходимо вызвать шаблон <em>&lt;xsl:call-template name="follow.js"/&gt;</em>.<br />
        Параметром <em>&lt;xsl:with-param name="modules"/&gt;</em> задается путь для загрузки модулей, по-умолчанию <em>"/js/modules/"</em><br />
        Параметр <em>&lt;xsl:with-param name="external"/&gt;</em> необходим для указания пути для загрузки зависимостей (@dependecy у <em>js:model</em>), по-умолчанию <em>"/js/external/"</em><br />
    </li>
</ol>

<h3>Оформление модулей в JavaScript</h3>
<code>
// Sample
Follow.module(
{
    model: "user-data",
    init: function( model, params )
    {
        alert('Hello world!');
        // this == Follow('user-data')
        // model == this()
        // params.modules - содержит путь до директории с модулями
        // params.external - содержит путь до директории, откуда загружать зависимости (внешние файлы, требуемые для работы модуля)
    }
});
</code>

<a href="../source/addons/follow.collector.xml" target="_blank">Пример XML-маппинга</a>
