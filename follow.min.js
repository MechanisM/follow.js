/*!
 * Follow.js - lightweight library for creating flexible web applications
 * Version: 1.0b
 * Project URL: https://github.com/extensible/follow.js
 */
var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/*!
 * Follow.js
 * ECMA-262 compatibility
 */
!Array.prototype.forEach&&(Array.prototype.forEach=function(d,c){if(typeof d!="function"){throw new Error("callback is not a function")}for(var b=0,a=this.length;b<a;b++){d.call(c,this[b],b,this)}});!Array.prototype.map&&(Array.prototype.map=function(c,a){var b=[];this.forEach(function(){b.push(c.apply(a,arguments))});return b});!Array.prototype.filter&&(Array.prototype.filter=function(c,a){var b=[];this.forEach(function(d){c.apply(a,arguments)&&b.push(d)});return b});!Array.prototype.some&&(Array.prototype.some=function(d,c){if(typeof d!="function"){throw new Error("callback is not a function")}for(var b=0,a=this.length;b<a;b++){if(d.call(c,this[b],b,this)){return true}}return false});!Array.prototype.every&&(Array.prototype.every=function(b,a){return this.length==this.filter(b,a).length});!Array.prototype.indexOf&&(Array.prototype.indexOf=function(a,c){var c=Number(c)||0,d=this.length;if(c<d-1){c<0&&(c+=d);for(var b=c;b<d;b++){if(this[b]===a){return b}}}return -1});!String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});!Function.prototype.bind&&(Function.prototype.bind=function(c){var a=this,b=[].slice.call(arguments,1),e=function(){},d=function(){return a.apply(this instanceof e?this:(c||window),b.concat([].slice.call(arguments)))};e.prototype=this.prototype;d.prototype=new e;return d});
/*!
 * Follow.js
 * Core of the library.
 */
(function(d){var b={},a={};function c(k,o,l){var o=o||b,k=k||"default",m=o[k],j=a[k];l&&(o[k]="");if(j&&o==j.storage){return j.model}var n=function(p,y,u){var z=n,v=f(arguments),t=JSON.parse(z.toJSON()),p=p instanceof Array?p.join("."):p,A=typeof p=="object"?{}:String(p).split("."),q,x=t,u={if_not_defined:u=="safe",is_forced:u=="force"};function w(){while(q=A.shift()){if(q&&x[q]!==d){x=x[q]}else{x=null;break}}var B=e(x);if(z.__get[B]){x=z.get[B].apply(z,[x,v])}return x}function r(){while(q=A.shift()){if(A.length==0){var E=x[q],G=E===d,F={chain:p,prop:q,parent:x},B=typeof y=="function"?y.apply(z,[typeof E!="object"?E:z.clone(E),g({value:E},F)]):y,C=e(B),D=B===d;z.__set[C]&&(B=z.__set[C].apply(z,[B,v]));(!u.if_not_defined||G)&&((D&&!G)||!D)&&((z.toJSON(p)!==i(B))||(B===null&&G)||(u.is_forced))&&function(){(B===d&&x instanceof Array)?x.splice(q,1):(x[q]=B);o[k]=i(t);z.tracking(p);z.broadcast(p,[B,g({value:{prev:E,current:B}},F)])}()}else{!x[q]&&(x[q]={});x=x[q]}}}z.__hook&&z.__hook.apply(z,v);if(typeof p=="object"){for(var s in p){p.hasOwnProperty(s)&&z(s,p[s],v[1])}return z}else{if(v.length==1){return w()}else{if(v.length>=2){r();return z}}}return t};g(n,{constructor:c,modelName:k,storage:o,followers:{},dependency:{composite:{},on:{}},backups:[],wrappers:[],__set:{},__get:{},extend:g,serialize:i,clone:h,gettype:e,init:function(p){this(m?JSON.parse(m):p||{});return this},toString:function(p){return p?i(this(p)):o[k]||"{}"}},c.prototype);a[k]={model:n,storage:o};return n}function i(j){return JSON.stringify(j,null,"\t")}function f(j){return[].slice.call(j)}function h(j){return JSON.parse(JSON.stringify(j))}function e(j){if(j===null){return"null"}else{if(j===d){return"undefined"}else{if(isNaN(j)&&String(j)=="NaN"){return"NaN"}else{return String((Object.prototype.toString.call(j).match(/\[object (\w+)\]/)||[])[1]).toLowerCase()}}}}function g(j,o){var k=f(arguments),n=j===true&&k.shift(),o=k.shift(),m=function(){return k[k.length-1]},p,l;typeof m()=="string"&&(l=k.pop());typeof m()=="function"&&(p=k.pop());k.forEach(function(w){for(var r in w){if(w.hasOwnProperty(r)){var v=o[r],t=w[r],q=v==null,x=["array","object"].indexOf(e(t))==-1,s=[true,o[r],t];if(p){var u=l?l+"."+r:String(r);p(u,t,r);s.push(p,u)}if(x||!n){o[r]=t}else{if(n){if(q||typeof v!="object"){s[1]=t instanceof Array?[]:{};o[r]=g.apply(this,s)}else{g.apply(this,s)}}}}}});return o}c.utils={extend:g,serialize:i,clone:h,type:e,array:f};c.extend=function(){g.apply(this,[true].concat(this.prototype,f(arguments)))};this.Follow=c}());
/*!
 * Follow.js
 * A main part of the library.
 */
Follow.extend({follow:function(b,d,c){var a=b instanceof RegExp;String(b).trim().split(/\s+/).forEach(function(e){var f=this.wrap.apply(this,[a?b:e,d,c]);!this.followers[e]&&(this.followers[e]=[]);this.followers[e].push(f)},this);return this},unfollow:function(a,b){String(a).trim().split(/\s+/).forEach(function(d){var c=this.followers[d];if(c){if(b){this.followers[d]=c.filter(function(e){return e.callback!=b})}if(!this.followers[d].length||!b){delete this.followers[d]}}},this);return this},toJSON:function(){return this.toString.apply(this,arguments)},clear:function(d,b){if(b){if(d){var c=this.dependency;delete this.followers[d];delete c.composite[d];for(var a in c.on){c.on.hasOwnProperty(a)&&(c.on[a]=c.on[a].filter(function(e){return e.chain!==d}))}}else{this.followers={};this.dependency={composite:{},on:{}}}}if(d){this(d,undefined)}else{delete this.storage[this.modelName]}return this},backup:function(a){var b={model:this.toJSON(),followers:this.extend(true,{},this.followers),dependency:this.extend(true,{},this.dependency)};a&&(this.backups[a]=b);this.backups.push(b);return this},restore:function(a){var a=a==null?-1:a,b=typeof a=="string"?this.backups[a]:this.backups.slice(a)[0];b&&(this.storage[this.modelName]=b.model,this.followers=b.followers,this.dependency=b.dependency);return this},composite:function(d,f,a){var e=this.dependency,c=e.composite[d];if(typeof f=="function"){this.__hook=function(g){if(g!==d){e.on[g]=e.on[g]||[];!e.on[g].some(function(h){return h.chain===d})&&e.on[g].push({chain:d,sensible:a})}};this.follow(d,function(g,h){delete this.__hook;e.composite[d]=function(){return f.call(this,{chain:h.chain,prop:h.prop})}},"once");this(d,function(g,h){return f.call(this,h)});return this}else{if(f===false){for(var b in e.on){if(e.on.hasOwnProperty(b)){e.on[b]=e.on[b].filter(function(g){return g.chain!==d})}}delete e.composite[d]}}return c},tracking:function(a){for(var b in this.dependency.on){this.dependency.on.hasOwnProperty(b)&&this.dependency.on[b].forEach(function(e){var d=[a===b,a.indexOf(b+".")===0],c=e.sensible?d.some(function(g){return g}):d.shift(),f=this.dependency.composite[e.chain];c&&f&&a!==e.chain&&this(e.chain,f.call(this))},this)}},dispatch:function(a,c,b){this(a,function(f){var e={number:typeof b=="number",func:typeof b=="function"},d=[].slice.call(arguments),g=this.extend(true,d,function(h,j){if(j[0]!==undefined){var l=j.shift(),i=h.constructor("params",{}),k=a.indexOf(".")==-1?a:a.split(".").slice(1).join(".");i(j.shift()||{});i("value",l);i("parent."+k,l);return[l,i()]}return j}(this,c||[]));this.broadcast(a,g,function(i,h){if(b!=null){if(e.number&&b==h){return true}if(e.func&&b==i.callback){return true}}else{return true}});return f});return this},broadcast:function(a,e,b){var d=this.followers,g=e[1]||{},c=this.constructor.sync;c&&c.call(this,{chain:a,value:e[0]});for(var f in d){d.hasOwnProperty(f)&&d[f].filter(b||function(){return true}).forEach(function(i){var h=i.path;(h==a||(h instanceof RegExp&&(g.match=a.match(h))))&&(i.callback.apply(this,e),delete g.match)},this)}},wrap:function(a,d,b){var c=this.wrappers;return c[b]?c[b].apply(this,arguments):{path:a,callback:d}},merge:function(c){var a=this,b=this.constructor("data",{data:this.serialize(c)});this.extend(true,{},c,function(d){var e=b(d);(typeof e!="object"||e===null)&&a(d,e)});return this},sizeof:function(d,a){var a=d===true||a,e=typeof d=="object"?d:d&&d!==true?this(d):this(),c=0,b=[a,{},e,function(){c++}];!a&&b.shift();this.extend.apply(this,b);return c},map:function(a,h,b){var f=typeof a!="object"?arguments.length?this(a):this():a,e=this.constructor.utils.type(f),c=["array","object"].indexOf(e)!==-1,l=[];if(c){for(var g in f){if(f.hasOwnProperty(g)){var j=f[g],k=[a,g].join("."),d=[j,g,k,f],i=function(){l.push(h.apply(this,d))}.bind(this);if(h){!b&&i();b&&b.apply(this,d)&&i()}else{l.push({key:g,value:j})}}}}else{l.push(f)}return l}});
/*!
 * Follow.js
 * Some hooks to change behavior data before set and after get actions.
 */
Follow.extend({__set:{array:function(c,b){var a={};c.forEach(function(e,d){a[d]=e});return a}}});
/*!
 * Follow.js
 * List of shortcuts which extend third argument "mode" in model.follow
 */
(function(){var a=function(b){return b.replace(/[\[\]\(\)\.\*\+\\\{\}\^\$]/g,"\\$&")};Follow.extend({wrappers:{once:function(c,d){var b=function(){d.apply(this,arguments);this.unfollow(c,b)};return{path:c,callback:b}},children:function(b,c){return{path:RegExp("^"+a(b)+".([^.]+)$"),callback:c}},sensible:function(c,d){var b=String(c),c=a(c);return{path:RegExp("^("+c+"|"+c+"\\..*)$"),callback:function(){this(b,function(e,f){d.apply(this,arguments);return e})}}}}})})();
/*!
 * Follow.js
 * Convertor JSON to XML.
 */
Follow.utils.json_to_xml=function(c,f){f=f||"";typeof c=="string"&&(c=typeof JSON=="object"?JSON.parse(c):Function("return "+c)());var a=this,b={str:[(!f?'<model type="'+this.type(c)+'">':'<slice path="'+f+'">'),"","\n",(!f?"</model>":"</slice>")],prop:{open:function(g,i,h,j){return'<p name="'+g+'" type="'+i+'" path="'+h+'"'+j+">"},close:function(g,h){var i=g-h;while(i--){b.str[1]+=this.offset(--g)+"</p>"}},offset:function(g){return"\n"+Array(g).join("\t")}}},e={level:/\./g,quote:/"/g};var d=1;this.extend(true,{},c,function(g,p,j){var o=a.type(p),h=(g.match(e.level)||[]).length+2,k=b.prop.offset(h),n=["array","object"].indexOf(o)!==-1,g=f?f+"."+g:g;if(n){var m=true;for(var l in p){if(p.hasOwnProperty(l)){m=false;break}}p=m?"/":""}else{p=' value="'+String(p).replace(e.quote,"&quot;")+'"/'}d>h&&b.prop.close(d,h);d=h;b.str[1]+=k+b.prop.open(j,o,g,p)});d>2&&b.prop.close(d,2);return b.str.join("")};Follow.utils.parse_xml=function(f){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(f,"text/xml")}else{if(document.implementation||typeof ActiveXObject!="undefined"){var d;try{d=document.implementation.createDocument()}catch(c){d=new ActiveXObject("MSXML2.DOMDocument")}d.loadXML(f);return d}else{var a="data:text/xml;charset=utf8,"+encodeURIComponent(f);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}};
/*!
 * Follow.js
 * Helper to easy find and update data in the model
 */
Follow.extend({select:function(c,a){var m=[],g=this,e=a?g(a):g(),p=g.constructor.utils,k=p.type(c),j={pathmask:k=="regexp",selector:k=="string"};if(j.selector){var l=a?"slice":"model",b=p.css2xpath(c,l),o=p.json_to_xml(e,a),f=p.parse_xml(o),q=f.documentElement;if(q.querySelectorAll){var n=b.css;n==l&&(q=f);m=p.array(q.querySelectorAll(n))}else{var n=b.xpath;if(document.evaluate){var r=q.evaluate(n,q,null,XPathResult.ANY_TYPE,null);while(node=r.iterateNext()){m.push(node)}}else{var r=q.selectNodes(n);for(var d=0;d<r.length;d++){m.push(r[d])}}}m=m.map(function(i){return{node:i.nodeName,name:i.getAttribute("name"),type:i.getAttribute("type"),path:i.getAttribute("path"),value:i.getAttribute("value")}});m.selector=n}if(j.pathmask){var h=a?a+".":"";p.extend(true,{},e,function(t,s,i){c.test(t)&&m.push({name:i,type:p.type(s),path:h+t,value:s})})}this.extend(m,{update:function(i){this.forEach(function(s){g(s.path,i)})},remove:function(){this.update(undefined)}});return m}});Follow.utils.css2xpath=function(d,a){var a=a||"root",d=d.trim(),c=d.replace(/(^:root)|((,\s*):root)/g,"$3"+a),b=d==":root"?"/"+a:d.replace(/(\*?)((?:\[.+?\])+)/g,function(e,f,h){var g=!f?"*":f,h=h.replace(/\[(\w+)(?:\s*=\s*("?)([^"]+?)\2)?\]/g,function(j,i,k,l,m){return"@"+i+(l?' = "'+l+'"':"")+" and "}).replace(/ and $/,"");return g+"["+h+"]"}).replace(/((?:\[.+?\])|\*)([\s,>]+)(:root)?/g,function(g,f,e,i){var h=e.trim();return f+((h==""&&"//")||(h==">"&&"/")||(h==","&&" | "+(i?i:".//"))||"")}).replace(/:root([\s>]*)/,function(f,e){var g=e.trim();return e?(g==""?".//":"./"):""}).replace(/^\*/,".//*");return{css:c,xpath:b}};
/*!
 * Follow.js
 * Helper for automatic sync the model-data with DOM-element's data via attribute "data-follow="a.special.path.in.the.model"
 * Dependencies: jQuery
 */
this.jQuery&&(function(b){var a={links:[]};Follow.link=function(c){a.links.push(c);return a.links};b(document).delegate("input[data-follow], select[data-follow], textarea[data-follow]","change",function(){var e=b(this),d=e.data("follow"),f={model:e.data("follow-model")||"",storage:e.data("follow-storage")||"undefined"},c=Function('return Follow("'+f.model+'", '+f.storage+")")();if(e.is(":checkbox")){c(d,e.prop("checked"))}else{c(d,e.val())}});Follow.sync=function(f){var c=this,d=f.chain,e=f.value;b('*[data-follow="'+d+'"]').each(function(){var h=b(this),i=false,g=function(){var l=h.data("follow-model")||"";var k=h.data("follow-storage")||"undefined";return c===Function('return Follow("'+l+'", '+k+")")()}(),j=function(){if(g){if(h.is(":checkbox")||h.is(":radio")){(h.is(":checkbox")||(h.is(":radio")&&h.val()==e))&&h.attr("checked",!!e)}else{if(h.is("input")||h.is("select")||h.is("textarea")){h.is("select[multiple]")&&c.gettype(e)!="array"&&(e=c.map(e,function(k){return k}));h.val(e)}else{if(h.is("img")){h.attr("src",e)}else{h.html(e)}}}}};b.each(a.links,function(){return(g&&h.is(this.match)&&(i=true)?this.trigger(h,e,j):true)});!i&&j()})};Follow.extend({importDataFromDOM:function(){var c=this,d={};b("[data-follow]").each(function(){var f=b(this),e=f.data("follow"),h={model:f.data("follow-model")||"",storage:f.data("follow-storage")||"undefined"},i=Function('return Follow("'+h.model+'", '+h.storage+")")();if(c===i&&!d[e]){var g;if(f.is(":checkbox")){g=f.prop("checked")}else{if(f.is(":radio")&&f.attr("name")){g=b(':radio[name = "'+f.attr("name")+'"]').val()}else{if(f.is("input")||f.is("select")||f.is("textarea")){g=f.val()}else{g=f.text()}}}d[e]=true;c(e,g)}})},exportDataToDOM:function(e){var d=this,e=e||"",c=e?this(e):this(),f=this.constructor.sync;e&&f.call(d,{chain:e,value:c});this.extend(true,{},c,function(h,g){f.call(d,{chain:(e?e+".":"")+h,value:g})})}})}(this.jQuery));
/*!
 * Follow.js (source/addons/follow.collector.js)
 * Modules support.
 * Dependencies: jQuery or yepnope.js for loading external JS-files
 */
(function(b){function a(c,d){var c=[].concat(c);if(b.yepnope){yepnope({load:c,complete:d})}else{if(b.jQuery){c=c.map(function(e){return $.ajax({url:e,dataType:"script"})});$.when.apply(this,c).then(d)}else{c.forEach(function(e){document.write('<script type="text/javascript" src="'+e+'"><\/script>')});d()}}}Follow.load=function(e,d){var c=[];e.forEach(function(i){var g=Follow(i.name,i.storage),h=i.module;if(h){var f=this.modules[h.name]||this.createModuleConfig();this.modules[h.name]=this.utils.extend(h,f);h._model=g;h._params=d;c.push(h)}i.chains.forEach(function(j){g(j.chain,j.json)})},this);c.forEach(function(h){var g=function(){var i=(h.path||h._params.modules)+encodeURIComponent(h.name)+".js";h.trigger("beforeload",[h._model,h._params]);a(i)};if(h.depends){var f=h._model;h.depends.trim().split(" ").every(function(i){var k=f(i),j=f.gettype(k);return(j=="array"||j=="object"?f.sizeof(k):j=="number"?String(k):k)})&&g()}else{g()}})};Follow.modules={};Follow.module=function(f){if(this.utils.type(f)=="string"){var e=this.modules[f]||(this.modules[f]=this.createModuleConfig());return e}var g=this.modules[f.name],c=f.depends,i=function(){g._config=f;f===f.init(g._model,g._params)&&(g._inited=true);g.trigger("ready",[g._model,g._params])};if(c){if(c.modules){var d=c.modules.trim().split(" ").filter(function(j){return !(this.modules[j]&&this.modules[j]._inited)},this);if(d.length){b.console&&console.error('Module "'+g.name+'" initialization error: module(s) "'+d.join(", ")+'" was not loaded or their init-method not returns this-object.');return false}}if(c.external){var h=c.external.trim().split(" ").map(function(j){return g._params.external+encodeURIComponent(j)+".js"});a(h,i)}else{i()}}else{i()}};Follow.createModuleConfig=function(){return{trigger:function(c,d){(this.events[c]||[]).forEach(function(e){e.apply(this,d)},this)},bind:function(c,d){this.events[c]=this.events[c]||[];this.events[c].push(d)},events:{}}}}(this));