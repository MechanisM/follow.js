/*!
 * Follow.js - lightweight library for creating flexible web applications
 * Version: 1.0b
 * Project URL: https://github.com/extensible/follow.js
 */
var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/*!
 * Follow.js
 * ECMA-262 compatibility
 */
!Array.prototype.forEach&&(Array.prototype.forEach=function(d,c){if(typeof d!="function"){throw new Error("callback is not a function")}for(var b=0,a=this.length;b<a;b++){d.call(c,this[b],b,this)}});!Array.prototype.map&&(Array.prototype.map=function(c,a){var b=[];this.forEach(function(){b.push(c.apply(a,arguments))});return b});!Array.prototype.filter&&(Array.prototype.filter=function(c,a){var b=[];this.forEach(function(d){c.apply(a,arguments)&&b.push(d)});return b});!Array.prototype.some&&(Array.prototype.some=function(d,c){if(typeof d!="function"){throw new Error("callback is not a function")}for(var b=0,a=this.length;b<a;b++){if(d.call(c,this[b],b,this)){return true}}return false});!Array.prototype.every&&(Array.prototype.every=function(b,a){return this.length==this.filter(b,a).length});!Array.prototype.indexOf&&(Array.prototype.indexOf=function(a,c){var c=Number(c)||0,d=this.length;if(c<d-1){c<0&&(c+=d);for(var b=c;b<d;b++){if(this[b]===a){return b}}}return -1});!String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});!Function.prototype.bind&&(Function.prototype.bind=function(c){var a=this,b=[].slice.call(arguments,1),e=function(){},d=function(){return a.apply(this instanceof e?this:(c||window),b.concat([].slice.call(arguments)))};e.prototype=this.prototype;d.prototype=new e;return d});
/*!
 * Follow.js
 * Core of the library.
 */
(function(){var f={},c={};function b(h,l,i){var l=l||f,h=h||"default",j=l[h],g=c[h];i&&(l[h]="");if(g&&l==g.storage){return g.model}var k=function(m,v,r){var w=k,s=e(arguments),q=JSON.parse(w.toJSON()),m=m instanceof Array?m.join("."):m,x=typeof m=="object"?{}:String(m).split("."),n,u=q,r={if_not_defined:r=="safe",is_forced:r=="force"};function t(){while(n=x.shift()){if(n&&u[n]!==undefined){u=u[n]}else{return null}}return u}function o(){while(n=x.shift()){if(x.length==0){var z=u[n],B=z===undefined,A={chain:m,prop:n,parent:u},y=typeof v=="function"?v.apply(w,[typeof z!="object"?z:w.clone(z),d({value:z},A)]):v;((w.toJSON(m)!==a(y))||(y===null&&B)||(r.is_forced))&&(!r.if_not_defined||B)&&function(){(y===undefined&&u instanceof Array)?u.splice(n,1):(u[n]=y);l[h]=a(q);w.tracking(m);w.broadcast(m,[y,d({value:{prev:z,current:y}},A)])}()}else{!u[n]&&(u[n]={});u=u[n]}}}w.__hook&&w.__hook.apply(w,s);if(typeof m=="object"){for(var p in m){m.hasOwnProperty(p)&&w(p,m[p],s[1])}return w}else{if(s.length==1){return w.__get(t(),s)}else{if(s.length>=2){o();return w}}}return q};d(k,{constructor:b,modelName:h,storage:l,followers:{},dependency:{composite:{},on:{}},backups:[],wrappers:[],__hook:null,__get:function(m){return m},extend:d,clone:function(m){return JSON.parse(JSON.stringify(m))},init:function(m){this(j?JSON.parse(j):m||{});return this},toString:function(m){return m?a(this(m)):l[h]||"{}"}},b.prototype);c[h]={model:k,storage:l};return k}function a(g){return JSON.stringify(g,null,"\t")}function e(g){return[].slice.call(g)}function d(g,l){var h=e(arguments),k=g===true&&h.shift(),l=h.shift(),j=function(){return h[h.length-1]},m,i;typeof j()=="string"&&(i=h.pop());typeof j()=="function"&&(m=h.pop());h.forEach(function(q){for(var n in q){if(q.hasOwnProperty(n)){var p=null,s=q[n];k&&typeof s=="object"&&s!==null&&(p=s.constructor==Array?[]:s.constructor==Object?{}:"");var o,r=[true,p,l[n],s];m&&(o=i?i+"."+n:String(n),m(o),r.push(m,o));l[n]=p?d.apply(this,r):s}}});return l}b.extend=function(){d.apply(null,[true].concat(this.prototype,e(arguments)))};window.Follow=b}());
/*!
 * Follow.js
 * A main part of the library.
 */
Follow.extend({follow:function(b,d,c){var a=b instanceof RegExp;String(b).trim().split(/\s+/).forEach(function(e){var f=this.wrap.apply(this,[a?b:e,d,c]);!this.followers[e]&&(this.followers[e]=[]);this.followers[e].push(f)},this);return this},unfollow:function(a,b){String(a).trim().split(/\s+/).forEach(function(d){var c=this.followers[d];if(c){if(b){this.followers[d]=c.filter(function(e){return e.callback!=b})}if(!this.followers[d].length||!b){delete this.followers[d]}}},this);return this},toJSON:function(){return this.toString.apply(this,arguments)},clear:function(e,c){if(c){if(e){var a,d=this.dependency;delete this.followers[e];delete d.composite[e];for(var b in d.on){d.on.hasOwnProperty(b)&&(d.on[b]=d.on[b].filter(function(f){return f.chain!==e}))}}else{this.followers={};this.dependency={composite:{},on:{}}}}if(e){this(e,undefined)}else{delete this.storage[this.modelName]}return this},backup:function(a){var b={model:this.toJSON(),followers:this.extend(true,{},this.followers),dependency:this.extend(true,{},this.dependency)};a&&(this.backups[a]=b);this.backups.push(b);return this},restore:function(a){var a=a==null?-1:a,b=typeof a=="string"?this.backups[a]:this.backups.slice(a)[0];b&&(this.storage[this.modelName]=b.model,this.followers=b.followers,this.dependency=b.dependency);return this},composite:function(d,f,a){var e=this.dependency,c=e.composite[d];if(typeof f=="function"){this.__hook=function(g){if(g!==d){e.on[g]=e.on[g]||[];!e.on[g].some(function(h){return h.chain===d})&&e.on[g].push({chain:d,sensible:a})}};this.follow(d,function(g,h){delete this.__hook;e.composite[d]=function(){return f.call(this,{chain:h.chain,prop:h.prop})}},"once");this(d,function(g,h){return f.call(this,h)});return this}else{if(f===false){for(var b in e.on){if(e.on.hasOwnProperty(b)){e.on[b]=e.on[b].filter(function(g){return g.chain!==d})}}delete e.composite[d]}}return c},tracking:function(a){for(var b in this.dependency.on){this.dependency.on.hasOwnProperty(b)&&this.dependency.on[b].forEach(function(e){var d=[a===b,a.indexOf(b+".")===0],c=e.sensible?d.some(function(g){return g}):d.shift(),f=this.dependency.composite[e.chain];c&&f&&a!==e.chain&&this(e.chain,f.call(this))},this)}},dispatch:function(a,c,b){this(a,function(f){var e={number:typeof b=="number",func:typeof b=="function"},d=[].slice.call(arguments),g=this.extend(true,d,function(h,j){if(j[0]!==undefined){var l=j.shift(),i=h.constructor("params",{}),k=a.indexOf(".")==-1?a:a.split(".").slice(1).join(".");i(j.shift()||{});i("value",l);i("parent."+k,l);return[l,i()]}return j}(this,c||[]));this.broadcast(a,g,function(i,h){if(b!=null){if(e.number&&b==h){return true}if(e.func&&b==i.callback){return true}}else{return true}});return f});return this},broadcast:function(a,d,b){var c=this.followers,f=d[1]||{};for(var e in c){c.hasOwnProperty(e)&&c[e].filter(b||function(){return true}).forEach(function(h){var g=h.path;(g==a||(g instanceof RegExp&&(f.match=a.match(g))))&&(h.callback.apply(this,d),delete f.match)},this)}},wrap:function(a,d,b){var c=this.wrappers;return c[b]?c[b].apply(this,arguments):{path:a,callback:d}},merge:function(a){var b=this.constructor("merge"),c=[];b(a);this.extend(true,{},a,function(d){c.push(d)});c.forEach(function(d){var e=b(d);(typeof e!="object"||e===null)&&this(d,e)},this);b.clear();return this}});
/*!
 * Follow.js
 * Data-mapper for collections (arrays) in the model.
 */
Follow.extend({select:function(path,condition,returnValue){var model=this,collection=model(path),stack=[],chains=[],checklist={},value;if(collection instanceof Array){collection.forEach(function(elem,index){try{var expr=!condition?true:condition.replace(/([A-Z0-9_\$\.]+)(?:\[(>=?|<=?|==?|!=?)(.*?)\])?/gi,function(S,chain,compare,value){var prop=chain.split(".").shift();if(elem.hasOwnProperty(prop)){if(compare&&value){compare.charAt(0)=="="&&(compare="===");compare.charAt(0)=="!"&&(compare="!==");!checklist[chain]&&(checklist[chain]=value.match(/^((["']).*?\2|\d+(?:\.\d+)?|true|false|null)$/)||(value.match(/^[A-Z0-9_$\.]+$/i)&&{parse:true}));if(checklist[chain]){checklist[chain]["parse"]&&elem.hasOwnProperty(value.split(".").shift())&&(value=model.toJSON([path,index,value].join(".")));return eval("(elem."+chain+compare+value+")")}return false}return chain==prop?true:model([path,index,chain].join("."))!==null}return false});var bool=Function("return "+expr)();if(bool){var chain={index:index,path:[path,index]};if(returnValue){var value,prop=returnValue.split(".").shift();elem.hasOwnProperty(prop)&&(value=eval("(elem."+returnValue+")"));value!==undefined&&(chain.path.push(returnValue),chains.push(chain),stack.push(value))}else{stack.push(elem);chains.push(chain)}}}catch(e){}},this)}stack.update=function(value,every){if(arguments.length){var branch=model.constructor("merge");branch(path,collection);chains.reverse().forEach(function(chain){var chain=chain.path.join(".");branch(chain,value);every&&model(chain,value)});!every&&model(path,branch(path));branch.clear()}return model};stack.remove=function(every){return this.update(undefined,every)};return stack}});
/*!
 * Follow.js
 * Helper for collections (arrays) in the model.
 */
Follow.extend({__get:function(d,b){if(d instanceof Array){var a=this,c=b.shift();this.extend(d,{splice:function(j,g){var f=[].slice.call(arguments,2),e=j+Math.max(g,f.length);[].splice.apply(this,arguments);a(c,this);while(j<e){var i=[c,j++].join("."),h=f.shift();a.dispatch(i,[h])}},push:function(){var e=[].slice.call(arguments);this.splice.apply(this,[this.length,0].concat(e))},unshift:function(){var e=[].slice.call(arguments);this.splice.apply(this,[0,0].concat(e))},shift:function(){this.splice.apply(this,[0,1])},pop:function(){this.splice.apply(this,[this.length-1,1])}})}return d}});
/*!
 * Follow.js
 * List of shortcuts which extend third argument "mode" in model.follow
 */
(function(){var a=function(b){return b.replace(/[\[\]\(\)\.\*\+\\\{\}\^\$]/g,"\\$&")};Follow.extend({wrappers:{once:function(c,d){var b=function(){d.apply(this,arguments);this.unfollow(c,b)};return{path:c,callback:b}},children:function(b,c){return{path:RegExp("^"+a(b)+".([^.]+)$"),callback:c}},sensible:function(c,d){var b=String(c),c=a(c);return{path:RegExp("^("+c+"|"+c+"\\..*)$"),callback:function(){this(b,function(e,f){d.apply(this,arguments);return e})}}}}})})();
/*!
 * Follow.js
 * A simple unpacker for raw-data of "follow.collector.xsl"
 * Dependencies: jQuery or yepnope.js for loading external JS-files
 */
(function(c,b){function a(d,e){var d=[].concat(d);if(b.yepnope){yepnope({load:d,complete:e})}else{if(b.jQuery){d=d.map(function(f){return c.ajax({url:f,dataType:"script"})});c.when.apply(this,d).then(e)}else{d.forEach(function(f){document.write('<script type="text/javascript" src="'+f+'"><\/script>')});e()}}}Follow.load=function(e,d){e.forEach(function(k){var g=Follow(k.name,k.storage),i=k.dependency,f=k.isModule;Follow.module.params=Follow.module.params||{};Follow.module.params[g.modelName]=d;k.chains.forEach(function(l){g(l.chain,l.json)});if(f){var h=function(){a(d.modules+g.modelName+".js")};if(i){var j=i.split(" ").map(function(l){return d.external+l+".js"});a(j,h)}else{h()}}})};Follow.module=function(e){var d=Follow(e.model,e.storage),f=this.module.params[d.modelName];e.init(d,f)}}(window.jQuery,window));